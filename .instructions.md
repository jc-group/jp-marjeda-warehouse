## Proyecto
- Next.js 16 (App Router) con React 19, TypeScript y Tailwind CSS v4 (tema inline en `src/app/globals.css` usando variables `--font-geist-*`). Supabase como backend (Auth, PostgREST, Storage, RPC `move_inventory`), Heroicons para íconos.
- Tipos de Supabase generados en `src/types/supabase.ts`; utilidades de cliente/servidor en `src/utils/supabase/{client,server,admin,middleware}.ts`.
- Layout principal en `src/app/layout.tsx`; las páginas server obtienen rol con `getUserRole()` y lo pasan a componentes cliente que renderizan `AdminShell` (sidebar + header + sesión/toast).
- Varias rutas están en modo placeholder (`PlaceholderPage`); secciones activas: login, inventario, alta de producto, ubicaciones, perfil, creación de usuarios.

## Comandos
- `npm run dev` levanta el proyecto.
- `npm run build` genera el build de producción.
- `npm start` sirve el build.
- `npm run lint` ejecuta ESLint (config Next core-web-vitals + TypeScript).

## Variables de entorno necesarias
- `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`: obligatorias para cualquier ruta; si faltan, el `middleware` redirige a `/login`.
- `SUPABASE_SERVICE_ROLE_KEY`: requerida para crear usuarios (`createUserAction` vía `createAdminClient`).
- Storage: bucket `products` para imágenes; se construye URL pública con `${NEXT_PUBLIC_SUPABASE_URL}/storage/v1/object/public/products/{path}`. Imagen por defecto: `default.webp`.

## Patrones y arquitectura
- Dominio/Use cases en `src/core`: `MoveInventory` y `RegisterProduct` validan rol (`admin` u `operador`) consultando `user_profiles.role`; usan repos Supabase de `src/infrastructure/supabase`.
- Acciones de servidor en `src/app/actions/*` manejan formularios (`useActionState` en cliente), muestran toast y hacen `revalidatePath` según la vista.
- Autenticación: `middleware.ts` protege casi todas las rutas y mantiene la sesión vía `updateSession`; login en `/login` usa `supabase.auth.signInWithPassword`. Página `/auth/callback` procesa hash de OAuth/email, `/auth/confirm` verifica OTP (invite/redirecciona a `/update-password`), `/update-password` llama a `supabase.auth.updateUser`.
- Datos de inventario (cliente) via `fetchInventory` con `createClient` browser; movimientos se registran con `registerMovementAction` que invoca `MoveInventory` (RPC `move_inventory`, tipo `IN` fijo).
- Registro de productos: `createProductAction` calcula costo MXN usando `SupabaseCurrencyRepo`, sube imagen opcional (si es `File`, usa storage; si no, `default.webp`), y opcionalmente genera movimiento inicial hacia la ubicación indicada.
- UI: componentes básicos en `src/components/ui` (Button, Card, Input, etc.) sin `class-variance-authority`; utilidades de clases con `cn`. `AdminShell` filtra navegación según rol y muestra badge de rol; evita olvidar pasar el rol para restringir vistas.

## Consideraciones al modificar
- Mantener acciones sensibles en el servidor (`"use server"`) y usar `createClient`/`createAdminClient` apropiado (browser vs server vs service role).
- Roles se leen de `user_profiles`; evita hardcodear permisos fuera de `core/domain/user.ts`.
- Tailwind v4 usa `@import "tailwindcss";` y `@theme inline`; respeta la paleta y evita dependencias de clases personalizadas fuera de los tokens existentes.
- Si añades nuevas secciones, reutiliza `AdminShell` y, si son solo placeholders, usa `PlaceholderPage`.
- No hay pruebas automatizadas; valida manualmente flujo de login, CRUD de productos/movimientos y protecciones de middleware.
